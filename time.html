<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>炫酷时间</title>
</head>
<body style="height: 100%">
	<canvas id="canvas" style="height: 100%"></canvas>
	<script type="text/javascript" src="scripts/digit.js"></script>
	<script type="text/javascript">
	var WINDOW_WIDTH = document.documentElement.clientWidth-20;
	var WINDOW_HEIGHT = document.documentElement.clientHeight-20;
	var RADIUS = Math.round(WINDOW_WIDTH*4/5/108)-1;
	var MARGIN_TOP = Math.round(WINDOW_HEIGHT/5);
	var MARGIN_LEFT = Math.round(WINDOW_WIDTH/10); 
	var balls = [];
	var curTime = new Date();
	const colors = ["#33B5E5","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
		window.onload = function(){
			var canvas = document.getElementById('canvas');
			var context = canvas.getContext('2d');
			canvas.height = WINDOW_HEIGHT;
			canvas.width = WINDOW_WIDTH;
			setInterval(function(){
				context.clearRect(0,0,canvas.width,canvas.height);
				render(context);
				renderBalls(context);
			},50);
		}

		function render(context){
			var hours = curTime.getHours();
			var minutes = curTime.getMinutes();
			var seconds = curTime.getSeconds();
			renderDigit(MARGIN_LEFT,MARGIN_TOP,parseInt(hours/10),context);
			renderDigit(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(hours%10),context);
			renderDigit(MARGIN_LEFT+30*(RADIUS+1),MARGIN_TOP,10,context);
			renderDigit(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(minutes/10),context);
			renderDigit(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(minutes%10),context);
			renderDigit(MARGIN_LEFT+69*(RADIUS+1),MARGIN_TOP,10,context);
			renderDigit(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(seconds/10),context);
			renderDigit(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(seconds%10),context);
			var nextTime = new Date();
			var nexthours = nextTime.getHours();
			var nextminutes = nextTime.getMinutes();
			var nextseconds = nextTime.getSeconds();
			if (curTime.getSeconds() != nextTime.getSeconds()) {
				curTime = nextTime;
				if (parseInt(hours/10) != parseInt(nexthours/10)) {
					addBalls(MARGIN_LEFT,MARGIN_TOP,parseInt(hours/10));
				}
				if (parseInt(hours%10) != parseInt(nexthours%10)) {
					addBalls(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(hours%10));
				}
				if (parseInt(minutes/10) != parseInt(nextminutes/10)) {
					addBalls(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(minutes/10));
				}
				if (parseInt(minutes%10) != parseInt(nextminutes%10)) {
					addBalls(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(minutes%10));
				}
				if (parseInt(seconds/10) != parseInt(nextseconds/10)) {
					addBalls(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(seconds/10));
				}
				if (parseInt(seconds%10) != parseInt(nextseconds%10)) {
					addBalls(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(seconds%10));
				}
				var cnt = 0;
				while(balls.length > 400){
					balls.splice(cnt,1);
					cnt++;
				}
			}
			console.log(balls.length);
		}
		function addBalls(x,y,num){
			for(var i = 0;i < digit[num].length;i++){
				for (var j = 0; j < digit[num][i].length; j++) {
					if (digit[num][i][j] == 1) {
						var aBall = {
							x:x+j*2*(RADIUS+1)+(RADIUS+1),
							y:y+i*2*(RADIUS+1)+(RADIUS+1),
							g:1.5+Math.random(),
							vx:Math.pow(-1,Math.ceil(Math.random()*1000))*4,//±4
							vy:-5,
							color:colors[Math.floor(Math.random()*colors.length)]
						};
						balls.push(aBall);
					}
				}
			}
		}
		function renderBalls(context){
			for(var i = 0;i < balls.length;i++){
				balls[i].x += balls[i].vx;
				balls[i].y += balls[i].vy;
				balls[i].vy += balls[i].g;
				if (balls[i].y >= WINDOW_HEIGHT-RADIUS) {
					balls[i].y = WINDOW_HEIGHT-RADIUS;
					balls[i].vy = -balls[i].vy*0.75;
				}
				context.fillStyle = balls[i].color;
					context.beginPath();
					context.arc(balls[i].x,balls[i].y,RADIUS,0,Math.PI*2,false);
					context.closePath();
					context.fill();
			}
		}
		function renderDigit(x,y,num,context){
			context.fillStyle = "rgb(0,102,153)";
			for(var i = 0;i < digit[num].length;i++){
				for(var j = 0;j < digit[num][i].length;j++){
					if (digit[num][i][j] == 1) {
						context.beginPath();
						context.arc(x+j*2*(RADIUS+1)+(RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1),RADIUS,0,2*Math.PI);
						context.closePath();
						context.fill();
					}
				}
			}
		}
	</script>
</body>
</html>